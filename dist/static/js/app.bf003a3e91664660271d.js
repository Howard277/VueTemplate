webpackJsonp([7],{"2gmu":function(e,t){},Ftwu:function(e,t){},NHnr:function(e,t,n){"use strict";function r(e){n("Ftwu")}function a(e){n("2gmu")}Object.defineProperty(t,"__esModule",{value:!0});var o=n("7+uW"),i=n("zL8q"),s=n.n(i),u=(n("tvR6"),n("//Fk")),c=n.n(u),l=n("gyMJ"),p={data:function(){return{children:null}},beforeRouteEnter:function(e,t,n){n(function(e){var t=e.$route.meta.children;e.children=t||null})},watch:{$route:function(e,t){var n=this.$route.meta.children;this.children=n||null}}},d=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.children?n("el-row",{attrs:{gutter:20}},e._l(e.children,function(t,r){return n("el-col",{key:r,attrs:{span:4}},[n("el-card",[n("div",{staticClass:"text"},[n("p",[e._v(e._s(t.name))]),e._v(" "),n("router-link",{attrs:{to:{name:t.name}}},[e._v("查看")])],1)])],1)})):e._e(),e._v(" "),n("router-view")],1)},f=[],h={render:d,staticRenderFns:f},m=h,g=n("VU/8"),v=g(p,m,!1,null,null,null),y=v.exports,b=[{path:"/",name:"首页",component:function(e){return n.e(2).then(function(){var t=[n("8hXn")];e.apply(null,t)}.bind(this)).catch(n.oe)},children:[{path:"/roles",name:"平台-角色管理",meta:{name:"角色管理"},component:function(e){return n.e(3).then(function(){var t=[n("1XJF")];e.apply(null,t)}.bind(this)).catch(n.oe)}},{path:"/accounts",name:"平台-账号管理",meta:{name:"账号管理"},component:function(e){return n.e(1).then(function(){var t=[n("jk0N")];e.apply(null,t)}.bind(this)).catch(n.oe)}},{path:"/goods",name:"商品管理",meta:{icon:"&#xe62e;"},component:y,children:[{path:"list",name:"商品信息",meta:{},component:function(e){return n.e(0).then(function(){var t=[n("8dlZ")];e.apply(null,t)}.bind(this)).catch(n.oe)}}]}]}],$=n("mt/N"),k=void 0,w={data:function(){return{menuData:null,userData:null}},methods:{getPermission:function(e){var t={};return Array.isArray(e)&&e.forEach(function(e,n){var r=e.resourcePath;t[r]=!0}),t},setInterceptor:function(e){var t=this;k=l.a.interceptors.request.use(function(n){var r=n.url.replace(n.baseURL,"").replace("/GET","").replace("/POST","").split("?")[0],a=r.match(/^(\/[^\/]+\/)[^\/]+$/);a&&(r=a[1]+"**");var o=r.match(/^\/[^\/]+\/([^\/]+)\/[^\/]+$/);return o&&(r=r.replace(o[1],"*")),e[n.method+","+r]?n:(console.warn(e,n.method+","+r),t.$message({message:"无访问权限，请联系企业管理员",type:"warning"}),c.a.reject({message:"no permission"}))})},getRoutes:function(e){var t=[],n=$.a(e),r={};!function e(t,n){t.map(function(t){if(t.route){var a=((n?n+"/":"")+t.route).replace(/^\//,"");r["/"+a]=!0,Array.isArray(t.children)&&e(t.children,t.route)}})}(n),this.$root.hashMenus=r;var a=$.c(b[0].children);return function e(n,a){var o=[];if(n.forEach(function(t){var n=(a?a+"/":"")+t.path;r[n]&&(Array.isArray(t.children)&&(t.children=e(t.children,t.path)),o.push(t))}),a)return o;t=t.concat(o)}(a),t},extendRoutes:function(e){var t=this,n=$.c(e);n.map(function(e){return e.children&&(e.meta||(e.meta={}),e.meta.children=e.children),e.beforeEnter=function(e,n,r){t.$root.hashMenus[e.path]?r():r("/401")}});var r=$.c(b);r[0].children=n,t.$router.addRoutes(r.concat([{path:"*",redirect:"/404"}]))},signin:function(e){var t=this,n=$.d("token");if(!n)return t.$router.push({path:"/login",query:{from:t.$router.currentRoute.path}});l.a.get("/login/checkTicket",{params:{ticket:n}}).then(function(n){var r=n.data,a=(t.getPermission(r.commission_resource_list),t.getRoutes(r.commission_resource_list));if(!a||!a.length)return $.d("token",""),document.body.innerHTML="<h1>账号访问受限，请联系系统管理员！</h1>";t.extendRoutes(a),t.menuData=a,t.userData=r,"function"==typeof e&&e()})},loginDirect:function(e){var t=this;this.signin(function(){t.$router.replace({path:e||"/"})})},logoutDirect:function(){$.d("token",""),l.a.interceptors.request.eject(k),this.$root.hashMenus={},l.a.defaults.headers.common.Authorization="",this.$router.replace({path:"/login"})}},created:function(e){this.signin()}},_=function(){var e=this,t=e.$createElement;return(e._self._c||t)("router-view",{attrs:{id:"app"},on:{login:e.loginDirect,logout:e.logoutDirect}})},A=[],R={render:_,staticRenderFns:A},x=R,E=n("VU/8"),C=r,F=E(w,x,!1,C,null,null),L=F.exports,M=n("/ocq"),j=n("aozt"),D=n.n(j),N=(n("mgIi"),function(e){return D.a.get("http://localhost:8081/login/checkUser",{params:e})}),S={data:function(){return{username:"",password:"",isBtnLoading:!1}},computed:{btnText:function(){return this.isBtnLoading?"登录中...":"登录"}},methods:{login:function(){var e=this;if(!e.username)return void e.$message.error("请填写用户名！！！");if(!e.password)return void e.$message.error("请填写密码");var t={username:e.username,password:e.password,targetAppCode:"testApp"};e.isBtnLoading=!0,N(t).then(function(t){if(e.isBtnLoading=!1,!t.data)return c.a.reject({message:"登录异常！"});$.d("token",t.data),e.$emit("login",e.$router.currentRoute.query.from)}).catch($.b)}},created:function(){sessionStorage.clear()}},q=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"g-center login-page",on:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.login(t):null}}},[n("el-form",{staticClass:"login-form"},[n("el-form-item",[n("el-input",{attrs:{autofocus:!0,placeholder:"请输入账号"},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}},[n("template",{slot:"prepend"},[n("i",{staticClass:"el-icon-mobile-phone"})])],2)],1),e._v(" "),n("el-form-item",[n("el-input",{attrs:{placeholder:"请输入密码",type:"password"},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}},[n("template",{slot:"prepend"},[n("i",{staticClass:"el-icon-info"})])],2)],1),e._v(" "),n("el-form-item",[n("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary",loading:e.isBtnLoading},nativeOn:{click:function(t){return e.login(t)}}},[e._v(e._s(e.btnText))])],1)],1)],1)])},T=[],I={render:q,staticRenderFns:T},U=I,z=n("VU/8"),B=a,J=z(S,U,!1,B,"data-v-389010fd",null),O=J.exports;o.default.use(M.a);var P=[{path:"/login",name:"登录",component:O},{path:"/401",name:"无权访问",component:function(e){return n.e(5).then(function(){var t=[n("l/MN")];e.apply(null,t)}.bind(this)).catch(n.oe)}},{path:"/404",name:"找不到页面",component:function(e){return n.e(4).then(function(){var t=[n("7FDS")];e.apply(null,t)}.bind(this)).catch(n.oe)}}],H=new M.a({mode:"history",routes:P});H.beforeEach(function(e,t,n){var r=e.meta.name||e.name;window.document.title=(r?r+" - ":"")+"Vue-Access-Control",n()});var V=H;o.default.use(s.a),o.default.directive("has",{bind:function(e,t){o.default.prototype.$_has(t.value)||e.parentNode.removeChild(e)}}),new o.default({el:"#app",router:V,components:{App:L},template:"<App/>"})},gyMJ:function(e,t,n){"use strict";var r=n("aozt"),a=n.n(r),o=n("mt/N"),i=a.a.create({baseURL:"http://localhost:8081/",timeout:1e4});i.defaults.headers.post["Content-Type"]="application/json",i.interceptors.response.use(function(e){return e},o.b),t.a=i},"mt/N":function(e,t,n){"use strict";n.d(t,"d",function(){return p}),n.d(t,"c",function(){return d}),n.d(t,"a",function(){return f}),n.d(t,"b",function(){return h});var r=n("//Fk"),a=n.n(r),o=n("mvHQ"),i=n.n(o),s=n("pFYg"),u=n.n(s),c=n("7+uW"),l=n("zL8q");n.n(l);c.default.component(l.Message.name,l.Message);var p=function(e,t){if(void 0===t){var n=sessionStorage.getItem(e);return n&&0===n.indexOf("autostringify-")?JSON.parse(n.split("autostringify-")[1]):n}return("object"===(void 0===t?"undefined":u()(t))||Array.isArray(t))&&(t="autostringify-"+i()(t)),sessionStorage.setItem(e,t)},d=function e(t){if(!t)return t;var n=t instanceof Array?[]:{};for(var r in t)n[r]="object"===u()(t[r])?e(t[r]):t[r];return n},f=function(e,t){console.info("array:"+i()(e)),console.info("ckey:"+i()(t));var n=[],r=Array.isArray(e)?e.map(function(e){return e.id}):[];t=t||"parentResourceCode",e.forEach(function(e,a){if(e[t]&&e[t]!==e.id){if(Array.isArray(r)){var o=r.findIndex(function(n){return n==e[t]});-1===o&&n.push(e)}}else delete e[t],n.push(d(e))});return function n(r){Array.isArray(r)&&r.length&&r.forEach(function(r){e.forEach(function(e){r.id===e[t]&&(r.children?r.children.push(e):r.children=[e])}),r.children&&n(r.children)})}(n),n},h=function(e){if(e.response)switch(e.response.status){case 400:c.default.prototype.$message({message:e.response.data.message||"请求参数异常",type:"error"});break;case 401:sessionStorage.removeItem("user"),c.default.prototype.$message({message:e.response.data.message||"密码错误或账号不存在！",type:"warning",onClose:function(){location.reload()}});break;case 403:c.default.prototype.$message({message:e.response.data.message||"无访问权限，请联系企业管理员",type:"warning"});break;default:c.default.prototype.$message({message:e.response.data.message||"服务端异常，请联系技术支持",type:"error"})}return a.a.reject(e)}},tvR6:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.bf003a3e91664660271d.js.map